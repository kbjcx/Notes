---
aliases: []
area: redis
project: 
date: 2023-08-03 13:54
tags: []
---
---
#### Content
Redis 是可以对 key 设置过期时间的，因此需要有相应的机制将已过期的键值对删除，而做这个工作的就是**过期键值删除策略**

#### 如何判定 key 已过期了？
每当我们对一个 key 设置了过期时间时，Redis 会把该 key 带上过期时间存储到一个过期字典（`expires dict`）中，也就是说「过期字典」保存了数据库中所有 key 的过期时间

过期字典存储在 redisDb 结构如下：
```cpp
typedef struct redisDb {
    dict *dict;    /* 数据库键空间，存放着所有的键值对 */
    dict *expires; /* 键的过期时间 */
    ....
} redisDb;
```

过期字典数据结构结构如下：
- 过期字典的 key 是一个指针，指向某个键对象；
- 过期字典的 value 是一个 `long long` 类型的整数，这个整数保存了 key 的过期时间

> [!attention] 
> 当我们查询一个 key 时，Redis 首先检查该 key 是否存在于过期字典中

#### 过期删除策略
##### 定时删除
定时删除策略的做法是，在设置 key 的过期时间时，同时创建一个定时事件，当时间到达时，由事件处理器自动执行 key 的删除操作

**优点：**
- 可以保证过期 key 会被尽快删除，也就是内存可以被尽快地释放。因此，定时删除对内存是最友好的

****
##### 惰性删除
##### 定期删除


---

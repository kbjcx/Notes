---
aliases: []
area: 分布式
project: 
date: 2023-08-05 17:37
tags: []
---
---
#### Content
在分布式系统中，除了 [[分布式数据分区|分区]]之外，系统还需要复制来将一份数据冗余存储在多个节点上，节点之间通过网络来同步数据，使之保持一致

#### 复制的好处
1. 增强数据的可用性和安全性。如果只把数据存放在单一的数据库服务器上，一旦该服务器永久损坏，将导致数据丢失、服务停止。通过复制技术将数据冗余存储，即使系统部分节点发生故障，系统也能继续工作，有时用户甚至没有发现系统部分节点出现过问题
2. 减少往返时间。不管你的数据库的处理有多快，数据仍然需要从客户端发起请求，通过网络传输到服务端，服务端处理完之后，数据也需要重走一遍来路，返回到客户端，这一段时间被称为往返时间（Round-Trip Time，RTT），往返时间是无法避免的。通过复制技术把数据存储到各个数据中心，可以将全国各地甚至全球不同用户的请求重定向到离用户位置更近的副本, 减少往返时间, 提升响应速度
3. 增加吞吐量。—台服务器能够处理的请求数存在物理上限，这种情况下复制出同样的几台服务器，可以提供更多处理读写请求的机器，系统的处理性能能够成倍增长

#### 单主复制
单主复制也叫主从复制或主从同步，即指定系统中的一个副本为主节点（有 Leader、Master 或 Primary 等多种叫法），客户端的写请求必须发送到主节点。其余的副本称为从节点（对应
Follower、Slave 或 Backup），从节点只能处理读请求，并从主节点同步最新的数据

主节点收到**写请求**时，除了将数据写入本地存储，还要负责将这次数据变更同步给所有从节点，以确保所有的副本保持数据—致。数据变更同步具体是**同步操作日志**还是**转发请求**，不同的系统有着不同的实现

根据系统以何种方式同步数据’又可以将单主复制分为三类：**同步复制，异步复制和半同步复制**

##### 同步复制
同步复制中的主节点执行完一个写请求（或一个事务）后，必须等待所有的从节点都执行完毕，并收到确认信息后，才可以回复客户端写入成功

同步复制保证了所有节点都写入完成后才返回给客户端，后续无论客户端从哪个副本读，都能读到刚才写入的数据。此外，同步复制还提升了数据可用性，即使主节点在写入完成后立即岩机，这次写入的数据也不会丢失

主节点必须等待直到所有副本写入完成写请求的性能必然会受到影响。如果碰巧某个时刻从节点 IO 负载过高导致处理请求很慢，那么将严重影响整个写请求

##### 异步复制
异步复制中主节点执行完写请求后，会立即将结果返回给客户端，无须等待其他副本是否写入完成。

由于主节点不需要再等待从节点写入完成，异步复制**不会影响写请求的性能**。但异步复制会潜在**影响副本数据的一致性和持久性**。例如，如果客户端收到写请求完成的响应后，立即去某个从节点读取数据，而此时写入操作还未同步到该副本，那么客户端会发现自己读不到刚才明明写入成功的数据，这种情况也许会导致客户端产生奇怪的行为。

除此之外，如果主节点在本地写入完成后立即岩机，那么写操作可能并没有同步到从节点上，如果此时强行将从节点提升为主节点，那么新的主节点上的数据并不完整，一个明明已经完成的写操作可能会丢失。

##### 半同步复制
半同步复制是介于同步复制和异步复制之间的一种复制机制。主节点只需要等待至少一个从节点同步写操作并返回完成信息即可，不需要等待所有的节点都完成。这等价于，有一个从节点是同步复制，其余的从节点则是异步复制，保证至少有两个节点拥有最新的数据副本，该从节点能随时接替主节点的工作

##### 优点
1. 简单易懂，易于实现
2. 仅在主节点执行并发写操作，能够**保证操作的顺序**，避免了还要考虑如何处理各个节点数据冲突这类复杂的情况，这个特性使得单主复制更容易支持事务类操作
3. 对于大量读请求工作负载的系统单主复制是**可扩展的**，可以通过增加多个从节点来提升读的性能

##### 缺点
1. 面对大量写请求工作负载时系统很难进行扩展，因为系统只有一个主节点，写请求的性能瓶颈由单个节点（主节点）决定
2. 当主节点岩机时，从节点提升为主节点不是即时的，可能会造成一些停机时间，甚至产生错误

#### 多主复制




---

---
aliases: []
area: 操作系统
project: 
date: 2023-09-04 16:43
tags: []
---
---
# 忙等待锁
## 测试和置位
测试和置位是 CPU 体系提供的**原子操作指令**——（Test-and-Set）

如果用 C 代码表示 Test-and-Set 指令，形式如下：
```c
int TestAndSet(int* old_ptr, int new) {
    int old = *old_ptr;
    *old_ptr = new;
    return old;
}
```
测试并设置指令主要完成两项工作：
1. 把 `old_ptr` 更新为 `new` 的新值
2. 返回 `old_ptr` 的旧值
> [!important] 
> 这些代码是**原子执行**，原子操作就是要么全部执行，要么都不执行，不能出现执行到一半的中间状态


---

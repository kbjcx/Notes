---
aliases: []
area: redis
project: 
date: 2023-08-03 16:26
tags: []
---
---
#### Content
Redis 提供了**主从复制模式**来避免避免单点故障，将数据备份到其他服务器上，让这些服务器也可以对外提供服务，这样即使有一台服务器出现了故障，其他服务器依然可以继续提供服务
![[Pasted image 20230803162806.png]]
这个模式可以保证多台服务器的数据一致性，且主从服务器之间采用的是「读写分离」的方式

主服务器可以进行读写操作，当发生写操作时自动将写操作同步给从服务器，而从服务器一般是只读，并接受主服务器同步过来写操作命令，然后执行这条命令

#### 第一次同步
多台服务器之间要通过什么方式来确定谁是主服务器，或者谁是从服务器呢？

我们可以使用 replicaof（Redis 5.0 之前使用 slaveof）命令形成主服务器和从服务器的关系。

比如，现在有服务器 A 和服务器 B，我们在服务器 B 上执行下面这条命令：
```cpp
// 服务器 B 执行这条命令
replicaof <服务器 A 的 IP 地址> <服务器 A 的 Redis 端口号>
```

服务器 B 就会变成服务器 A 的「从服务器」，然后与主服务器进行第一次同步，这个过程分为三个阶段：
1. 建立连接、协商同步
    用来同步主从服务器的 **runID**
1. 主服务器同步数据给从服务器
    通过生成 RDB 的方式来同步数据，由于 RDB 持久化是后台执行不阻塞主进程，因此在 **「主服务器生成 RDB、主服务器发送 RDB 文件、从服务器加载 RDB 文件」** 三个时间段内主服务器还会处理相关的命令，为了使主从服务器保持一致，会将这三个时间段内的命令写入到缓冲区，当
1. 主服务器发送新写操作命令给从服务器



---

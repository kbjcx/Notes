---
aliases: [硬中断, 软中断]
area: 操作系统
project: 
date: 2023-04-10 21:12
---
---
# Description
> [!quote]
> 中断是指计算机运行过程中, 出现某些意外情况需要主机干预时, 能自动停止正在运行的程序转而处理新情况的程序, 处理完毕后又转回原程序继续运行

## 中断的作用
1. **外设异步通知 CPU**
     外设发生了什么事情或者完成了什么任务或者有什么消息要告诉 CPU，都可以异步给 CPU 发通知。例如，网卡收到了网络包，磁盘完成了 IO 任务，定时器的间隔时间到了，都可以给 CPU 发中断信号
 1. **CPU 之间发送消息**
     在 SMP (对称多处理器) 系统中，一个 CPU 想要给另一个 CPU 发送消息，可以给其发送 IPI (处理器间中断)
 1. **处理 CPU 异常**
    CPU 在执行指令的过程中遇到了异常会给自己发送中断信号来处理异常。例如，做整数除法运算的时候发现被除数是 0，访问虚拟内存的时候发现虚拟内存没有映射到物理内存上
1. **实现系统调用**
    早期的系统调用就是靠中断指令来实现的，后期虽然开发了专用的系统调用指令，但是其基本原理还是相似的

## 中断的处理
### 执行场景
在中断产生之前是没有这个概念的，有了中断之后，CPU 就分为两个执行场景了，*进程执行场景 (process context)* 和 *中断执行场景 (interrupt context)*

==进程的执行是进程执行场景，同步中断的处理也是进程执行场景，异步中断的处理是中断执行场景==

**进程执行场景和中断执行场景有两个区别：**
1. 进程执行场景是可以调度、可以休眠的，而中断执行场景是不可以调度不可用休眠的；
2. 在进程执行场景中是可以接受中断信号的，而在中断执行场景中是屏蔽中断信号的。所以如果中断执行场景的执行时间太长的话，就会影响我们对新的中断信号的响应性，所以我们需要尽量缩短中断执行场景的时间

**对异步中断的处理有下面两类办法: **
1. 立即完全处理
    对于简单好处理的异步中断可以立即进行完全处理
1. 立即预处理 + 稍后完全处理
    对于处理起来比较耗时的中断可以采取立即预处理加稍后完全处理的方式来处理

立即完全处理和立即预处理都叫做中断预处理，把稍后完全处理叫做中断后处理。中断预处理只有一种实现方式，就是直接处理。但是中断后处理却有很多种方法，其处理方法可以运行在中断执行场景，也可以运行在进程执行场景，前者叫做直接中断后处理，后者叫做线程化中断后处理

在 Linux 中，中断预处理叫做**上半部**，中断后处理叫做**下半部**. 中断预处理只有一种方法，叫做 hardirq (硬中断), 


- 中断期间往往会暂停系统的中断请求, 因此一旦中断处理时间过长, 就有可能丢失中断请求, 于是将中断分为了上半部和下半部
    - 上半部用来快速处理中断<font color="#0593A2">「硬中断」</font>
    - 下半部用来延迟处理上半部未完成的事务<font color="#0593A2">「软中断」</font>
- 「硬中断」和「软中断」的分类依据不是触发机制吗, 而是其实现机制, 「硬中断」是由 CPU 这个硬件实现的中断机制, 而「软中断」是由软件实现的类似中断的机制, 由内核不断轮询「软中断」标志位, 决定执行哪个中断程序
---
# Source
- [硬中断和软中断\_软中断和硬中断\_Coder\_yupeng的博客-CSDN博客](https://blog.csdn.net/weixin_43215305/article/details/120027555)
- [2.6 什么是软中断？ | 小林coding](https://xiaolincoding.com/os/1_hardware/soft_interrupt.html)
---

---
aliases: []
area: redis
project: 
date: 2023-08-01 11:17
tags: []
---
---
#### Content
- 由于 [[AOF持久化#缺点|AOF持久化的缺点]]，Redis 增加了 RDB 快照来作为持久化的方式，它记录的是某一瞬间内存中的实际数据

> [!question] RDB 做快照时会阻塞线程吗？
> Redis 提供了两个命令来生成 RDB 文件，分别是 save 和 bgsave，他们的区别就在于是否在「主线程」里执行
> 1.  `save` 命令，就会在主线程生成 RDB 文件，由于和执行操作命令在同一个线程，所以如果写入 RDB 文件的时间太长，**会阻塞主线程**
> 2.  `bgsave` 命令，会创建一个子进程来生成 RDB 文件，这样可以**避免主线程的阻塞**

Redis 还可以通过配置文件的选项来实现每隔一段时间自动执行一次 bgsave 命令，默认会提供以下配置：
```cpp
save 900 1
save 300 10
save 60 10000
```
- 900 秒之内，对数据库进行了至少 1 次修改；
- 300 秒之内，对数据库进行了至少 10 次修改；
- 60 秒之内，对数据库进行了至少 10000 次修改

> [!attention] 
> Redis 的快照是**全量快照**，也就是说每次执行快照，都是把内存中的「所有数据」都记录到磁盘中。所以执行快照是一个比较重的操作，如果频率太频繁，可能会对 Redis 性能产生影响。如果频率太低，服务器故障时，丢失的数据会更多

> [!question] RDB 在执行快照的时候，数据能修改吗？
> 在执行 `bgsave` 命令时是可以更改数据的，`save` 命令会阻塞主进程，因此不行
> 关键技术在于写时复制技术

##### 优点
1. 恢复速度快

##### 缺点
1. 快照频率不好把握，频率太低会导致数据丢失多，频率太高会导致性能降低

---

---
aliases: []
area: 操作系统
project: 
date: 2023-06-19 18:42
tags: []
---
---
#### Description
- 网络 IO 代码如下:
```cpp
read(file, tmp_buf, len);
write(socket, tmp_buf, len);
```
- 虽然代码很简单, 但是却发生了 4 次用户态与内核态的上下文切换.
![[Pasted image 20230619184424.png]]
- 还发生了 4 次数据拷贝, 2 次是 [[直接内存访问|DMA]] 拷贝, 还有两次是 CPU 拷贝
- 这就需要零拷贝技术来减少上下文的切换和数据拷贝, 零拷贝的实现方式通常有 2 种.
##### mmap + write
- `read ()` 系统调用的过程中会把内核缓冲区的数据拷贝到用户的缓冲区里，于是为了减少这一步开销，我们可以用 `mmap ()` 替换 `read ()` 系统调用函数
```cpp
buf = mmap(file, len);
write(sockfd, buf, len);
```
- `mmap ()` 系统调用函数会直接把内核缓冲区里的数据「映射」到用户空间，这样，操作系统内核与用户空间就不需要再进行任何的数据拷贝操作
![[Pasted image 20230619185008.png]]




---
#### Source

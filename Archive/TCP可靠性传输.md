---
aliases: []
area: 计算机网络
project: 
date: 2023-06-13 20:08
tags: []
---
---
#### Description
> [!note] TCP 通过序列号、确认应答、重发控制、连接管理以及窗口控制来实现可靠性传输

##### 重传机制
- TCP 通过重传机制来实现网络丢包的问题
###### 超时重传
重传机制的其中一个方式，就是在发送数据时，设定一个定时器，当超过指定的时间后，没有收到对方的 ACK 确认应答报文，就会重发该数据，也就是我们常说的超时重传

- TCP 会在一下两种情况下发生超时重传：
    1. 数据包丢失
    2. 确认应答丢失

- 当超时时间 RTO 较大时，重发就慢，丢了老半天才重发，没有效率，性能差
- 当超时时间 RTO 较小时，会导致可能并没有丢就重发，于是重发的就快，会增加网络拥塞，导致更多的超时，更多的超时导致更多的重发

- **<font color="#0593A2">超时重传时间 RTO 的值应该略大于报文往返 RTT 的值</font>**

- RTO 的时间往往是动态变化的，需要 TCP 通过采样 RTT 的时间，然后进行加权平均，算出一个平滑 RTT 的值，而且这个值还是要不断变化的，因为网络状况不断地变化。除了采样 RTT，还要采样 RTT 的波动范围，这样就避免如果 RTT 有一个大的波动的话，很难被发现的情况

- 如果超时重发的数据，再次超时的时候，又需要重传的时候，TCP 的策略是**<font color="#0593A2">超时间隔加倍</font>**

###### 快速重传
- **<font color="#0593A2">不以时间为驱动，以数据驱动重传</font>**
- 快速重传的工作方式是当收到三个相同的 ACK 报文时，会在定时器过期之前，重传丢失的报文段
- 但是快速重传是的一个问题是，重传确认号所指向的报文还是之后的所有报文

###### SACK (选择性确认）
- 这种方式需要在 TCP 头部「选项」字段里加一个 SACK 的东西，它可以将已收到的数据的信息发送给「发送方」，这样发送方就可以知道哪些数据收到了，哪些数据没收到，知道了这些信息，就可以只重传丢失的数据

###### Duplicate SACK (D-SACK)
- 使用了 SACK 来告诉「发送方」有哪些数据被重复接收了
- 可见，D-SACK 有这么几个好处：
    1. 可以让「发送方」知道，是发出去的包丢了，还是接收方回应的 ACK 包丢了
    2. 可以知道是不是「发送方」的数据包被网络延迟了
    3. 可以知道网络中是不是把「发送方」的数据包给复制了

> [!note] ACK 报文丢失一般可以通过**<font color="#0593A2">累计确认</font>**来判断

##### 滑动窗口
- 窗口大小就是指**<font color="#0593A2">窗口大小就是指无需等待确认应答，而可以继续发送数据的最大值</font>**
- 窗口的实现实际上是操作系统开辟的一个缓存空间，发送方主机在等到确认应答返回之前，必须在缓冲区中保留已发送的数据。如果按期收到确认应答，此时数据就可以从缓存区清除
- 发送方的滑动窗口:
![[Pasted image 20230613205021.png]]
- SND. WND: 表示滑动窗口的大小
- SND. UNA: 指向已发送但未确认的第一个字节的序列号
- SND. NXT: 指向未发送但在可发送范围的第一个字节的序列号
- 未发送但在超过接收方处理范围的第一个字节的序列号用 SND. UNA+SND. WND 表示

- 接收方的滑动窗口
![[Pasted image 20230613210033.png]]
- RCV. WND: 表示接收窗口的大小, 会通告给发送方
- RCV. NXT: 指向期望从发送方发送来的下一个字节的序列号 (即未收到数据但在可接收范围的第一个字节的序列号)
- 不可以接收数据的第一个字节的序列号由 RCV. NXT + RCV. WND 得到

##### 流量控制
- 发送方不能无脑的发数据给接收方，要考虑接收方处理能力, 如果一直无脑的发数据给对方，但对方处理不过来，那么就会导致触发重发机制，从而导致网络流量的无端的浪费
- **<font color="#0593A2">流量控制</font>**可以让发送方根据接收方的实际接受能力控制发送的数据数量

- 如果



---
#### Source
- [4.2 TCP 重传、滑动窗口、流量控制、拥塞控制 | 小林coding](https://xiaolincoding.com/network/3_tcp/tcp_feature.html#%E8%B6%85%E6%97%B6%E9%87%8D%E4%BC%A0)
---
aliases: []
area: 分布式
project: 
date: 2023-08-05 16:15
tags: []
---
---
#### Content
分区分为垂直分区和水平分区

> [!attention] 
> 垂直分区和列相关，而一个表中的列是有限的，这就导致了垂直分区不能超过一定的限度，而水平分区则可以无限拆分。另外，表中数据以行为单位不断增长，而列的变动很少，因此, 水平分区更常见

#### 垂直分区
对表的列进行拆分，将某些列的整列数据拆分到特定的分区，并放入不同的表中。垂直分区减小了表的宽度，每个分区都包含了其中的列对应的所有行。垂直分区也被称为行拆分（RowSplimng），因为的每一行都按照其列进行拆分。例如，可以将不经常使用的列或者一个包含了大 text 类型或 BLOB 类型的列垂直分区，确保数据完整性的同时提高了访问性能。值得—提的是，列式数据库可以看作己经垂直分区的数据库

#### 水平分区
对表的行进行拆分，将不同的行放入不同的表中，所有在表中定义的列在每个分区中都能找到，所以表的特性依然得以保留

> [!tip]
> 在分布式系统领域，水平分区常称为**分片**

##### 水平分区算法
###### 范围分区
**范围分区**是指根据指定的关键字将数据集拆分为若干连续的范围，每个范围存储到一个单独的节点上。用来分区的关键字也叫分区键。
![[Pasted image 20230805162833.png]]

通常会选择额外的负载均衡节点或者系统中的一个节点来接收客户端请求，然后根据范围分区算法，确定请求应该重定向（路由）到哪个节点或哪几个节点


**优点：**
1. 实现相对简单
2. 能够对用来进行范围分区的关键字进行范围查询
3. 当使用分区键进行范围查询的范围较小且位于同一个节点时性能良好
4. 很容易通过修改范围边界增加或减少范围数据，能够简单有效地调整范围（重新分区）以平衡负载

**缺点：**
1. 无法利用分区键之外的其他关键字进行范围查询
2. 当查询的范围较大且位于多个节点时性能较差
3. 可能产生数据分布不均匀或请求流量不均的问题，导致某些数据的热点现象，从而某些节点的负载可能会很高

> [!important] 
> 范围分区适合需要实现范围查询的系统

###### 哈希分区
哈希分区的策略是将指定的关键字经过一个哈希函数的计算，根据计算得到的值来决定该数据集的分区

**优点：**
1. 数据的分布是随机的，分布相对均匀，能够在一定程度上避免热点问题

**缺点：**
1. 在不额外存储数据的情况下，无法执行范围查询
2. 在添加和删除节点的时候，由于每个节点都需要一个相应的哈希值，所以增加节点需要修改哈希函数，会导致数据的重新映射，引起数据的大规模移动

###### 一致性哈希
> [!tip]
> 一致性哈希是一种特殊的哈希分区算法，在分布式存储系统中用来缓解哈希分区增加或删除节点时引起的大规模数据移动问题

一致性哈希算法将整个哈希值组织成一个圆环，称为**哈希环**。将分布式的节点映射到圆环上，关键字也通过哈希计算映射到圆环上，并将其映射到顺时针方向上遇到的第一个节点。
![[Pasted image 20230805165404.png|500]]

那么如果要添加一个节点只需要将添加的节点左边的数据转移到新节点上，并从原节点删除相应的数据，其他数据可以保持不变

**优点：**
1. 对于节点的增减只需要重新分配哈希环上的一部分数据，改善了哈希分区大规模迁移的缺点
2. 在增加节点时不需要修改哈希函数
3. 一致性哈希有着更好的可扩展性和可管理性

**缺点：**
1. 当系统节点太少时，容易产生数据分布不均的问题
1. 当一个节点因为异常下线时，该节点的数据全部转移到顺时针方向的节点，从而导致顺时针方向的节点存储大量数据使该节点负载大量增加
1. 在不存储额外数据的情况下，无法进行高效的范围查询，任何范围查询都会发送到多个节点上

> [!faq] 怎么解决负载不均的问题？
> - 引入虚拟节点，虚拟节点并不是真实的物理服务器，虚拟节点是实际节点在哈希环中的副本，一个物理节点不再对应哈希环上的一个点，而是对应多个虚拟节点
> - 虚拟节点越多，数据分布就越均匀，当节点下线时，数据就会分摊给其他不同的节点，避免了某个节点独自承担负载
> - 同时可以根据节点的物理性能来选择分配不同的虚拟节点

#### 分区的挑战



---
